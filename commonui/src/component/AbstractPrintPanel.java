/*
 * AbstractPrintPanel.java
 *
 * Created on December 21, 2007, 5:56 PM
 */

package component;

import java.awt.print.Printable;
import java.awt.print.PrinterJob;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JTable;
import javax.swing.JTextPane;
import util.PanelUtil;

/**
 *
 * @author  Budoy Entokwa
 */
public abstract class AbstractPrintPanel extends javax.swing.JPanel implements Runnable {
	
	public String getHTML() {
		AbstractPanel pnl = MainWindow.getDisplayedModule();
		JTable tbl = pnl.getMasterTable();
		if (tbl instanceof ReadonlyTable) {
			ReadonlyTable read = (ReadonlyTable) tbl;
			int count = tbl.getSelectedRowCount();
			if (count > 0) {
				return read.getHTMLForRecord(tbl, tbl.getSelectedRow(), pnl.getTitle());
			}
		}
		return null;
	}
	
	/** Creates new form AbstractPrintPanel */
	public AbstractPrintPanel() {
		initComponents();
	}
	
	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {

        dlgPrint = new javax.swing.JDialog();
        jPanel2 = new javax.swing.JPanel();
        btnPrint = new javax.swing.JButton();
        pnlPrintArea = new javax.swing.JPanel();
        printPane = getTextPane();

        dlgPrint.setTitle("Print Preview");

        btnPrint.setText("Print");
        btnPrint.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPrintActionPerformed(evt);
            }
        });
        jPanel2.add(btnPrint);

        pnlPrintArea.setLayout(new java.awt.GridLayout(1, 0));

        javax.swing.GroupLayout dlgPrintLayout = new javax.swing.GroupLayout(dlgPrint.getContentPane());
        dlgPrint.getContentPane().setLayout(dlgPrintLayout);
        dlgPrintLayout.setHorizontalGroup(
            dlgPrintLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlPrintArea, javax.swing.GroupLayout.DEFAULT_SIZE, 400, Short.MAX_VALUE)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, dlgPrintLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)
                .addGap(10, 10, 10))
        );
        dlgPrintLayout.setVerticalGroup(
            dlgPrintLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, dlgPrintLayout.createSequentialGroup()
                .addComponent(pnlPrintArea, javax.swing.GroupLayout.DEFAULT_SIZE, 255, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        setBackground(new java.awt.Color(255, 255, 255));
        setLayout(new java.awt.GridLayout(1, 0));
    }// </editor-fold>//GEN-END:initComponents

private void btnPrintActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPrintActionPerformed
		Thread t = new Thread(this);
		t.start();
}//GEN-LAST:event_btnPrintActionPerformed
	
	
    // Variables declaration - do not modify//GEN-BEGIN:variables
    public javax.swing.JButton btnPrint;
    public javax.swing.JDialog dlgPrint;
    public javax.swing.JPanel jPanel2;
    public javax.swing.JPanel pnlPrintArea;
    public javax.swing.JTextPane printPane;
    // End of variables declaration//GEN-END:variables
	
	public void printMe() {
		String html = getHTML();
		if (html==null) {
			PanelUtil.showError(this, "No record to print.");
			return;
		}
		GenericPrintDisplayer.printHTML(html);
	}

    public void run() {
		Logger.getLogger("global").log(Level.INFO, "PRINTING DATA PANEL");
		PrinterJob printJob = PrinterJob.getPrinterJob();
		printJob.setPrintable((Printable)this.print);
		if (printJob.printDialog()){
			try{
				Logger.getLogger("global").log(Level.INFO, "PRINT NOW");
				printJob.print();
			}
			catch(Exception ex){
				Logger.getLogger("global").log(Level.ALL, "ERROR PRINTING");
				throw new RuntimeException(ex);
			}
		}
    }

	public JTextPane getTextPane() {
		return print;
	}
	
	PrintPane print = new PrintPane();
}
